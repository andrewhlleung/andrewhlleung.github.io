<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<title>åœ°åœ–æµ·å ±ç”Ÿæˆå™¨</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  form {
    background: white;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 3px 20px rgba(0,0,0,0.2);
    width: 440px;
    text-align: center;
  }

  #map-container {
    border: 12px solid #b08a58;
    border-radius: 8px;
    margin-bottom: 10px;
    position: relative;
    background: white;
  }

  #map {
    height: 320px;
    width: 100%;
    border-radius: 6px;
  }

  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
  }

  button {
    background: #0078d7;
    color: white;
    border: none;
    cursor: pointer;
  }

  button:hover {
    background: #005ea6;
  }

  h3 {
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<form onsubmit="submitForm(event)">
  <h3>åœ°åœ–æµ·å ±è¨­å®š</h3>
  
  <label>Localisation (æœå°‹åœ°é»):</label>
  <input type="text" id="searchBox" placeholder="è¼¸å…¥åœ°é»åç¨± (ä¾‹å¦‚: Tokyo)" />
  <button type="button" onclick="searchLocation()">ğŸ” æœå°‹åœ°é»</button>

  <div id="map-container">
    <div id="map"></div>
  </div>

  <label>åœ°åœ–æ¨£å¼ï¼š</label>
  <select id="styleSelect" onchange="changeStyle(this.value)">
    <option value="streets">æ¨™æº–åœ°åœ– (Streets)</option>
    <option value="toner">é»‘ç™½ (Toner)</option>
    <option value="topo">åœ°å½¢ (Topo)</option>
    <option value="satellite">è¡›æ˜Ÿåœ– (Satellite)</option>
    <option value="darkgold">æš—é»‘é‡‘ (Dark and Gold)</option>
  </select>

  <label>å°ºå¯¸ï¼š</label>
  <select id="sizeSelect">
    <option value="30x35">30 Ã— 35 cm</option>
    <option value="40x45">40 Ã— 45 cm</option>
    <option value="60x70">60 Ã— 70 cm</option>
  </select>

  <label>Line 1ï¼š</label>
  <input type="text" id="line1" placeholder="è¼¸å…¥ä¸»æ¨™é¡Œ (ä¾‹å¦‚: New York, United States)" />

  <label>Line 2ï¼š</label>
  <input type="text" id="line2" placeholder="è¼¸å…¥å‰¯æ¨™é¡Œ (ä¾‹å¦‚: 22.52Â°N, 114.21Â°E)" />

  <button type="submit">æäº¤åœ°åœ–è³‡æ–™</button>
</form>

<script>
  // âš ï¸ æ›æˆä½ çš„ MapTiler API Key
  const MAPTILER_KEY = "41uGlS49ziRg4ChbWBH9";

  const mapStyles = {
    streets: `https://api.maptiler.com/maps/streets-v2/{z}/{x}/{y}.png?key=${MAPTILER_KEY}`,
    toner: `https://api.maptiler.com/maps/toner/{z}/{x}/{y}.png?key=${MAPTILER_KEY}`,
    topo: `https://api.maptiler.com/maps/topo/{z}/{x}/{y}.png?key=${MAPTILER_KEY}`,
    satellite: `https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=${MAPTILER_KEY}`,

    darkgold: `https://api.maptiler.com/maps/019a494f-40d6-7dba-b962-6a9805f9a927/256/{z}/{x}/{y}.png?key=${MAPTILER_KEY}`

  };

  // åˆå§‹åŒ–åœ°åœ–
  const map = L.map('map', {
    center: [22.3193, 114.1694],
    zoom: 11
  });

  let currentLayer = L.tileLayer(mapStyles.streets, {
    attribution: '&copy; MapTiler &copy; OpenStreetMap contributors',
    crossOrigin: true
  }).addTo(map);

  // æ”¹è®Šåœ°åœ–æ¨£å¼
  function changeStyle(style) {
    map.removeLayer(currentLayer);
    currentLayer = L.tileLayer(mapStyles[style], {
      attribution: '&copy; MapTiler &copy; OpenStreetMap contributors',
      crossOrigin: true
    });
    map.addLayer(currentLayer);
  }

  // æœå°‹åœ°é»ä¸¦ç§»å‹•åœ°åœ–
  async function searchLocation() {
    const query = document.getElementById("searchBox").value;
    if (!query) return alert("è«‹è¼¸å…¥åœ°é»åç¨±");
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`;

    try {
      const res = await fetch(url);
      const results = await res.json();
      if (results.length === 0) {
        alert("æ‰¾ä¸åˆ°è©²åœ°é»ï¼Œè«‹å˜—è©¦å…¶ä»–åç¨±");
        return;
      }
      const { lat, lon, display_name } = results[0];
      map.setView([lat, lon], 12);
      document.getElementById("line1").value = display_name;
      document.getElementById("line2").value = `${parseFloat(lat).toFixed(2)}Â°N, ${parseFloat(lon).toFixed(2)}Â°E`;
    } catch (err) {
      console.error(err);
      alert("æœå°‹å¤±æ•—");
    }
  }

  // æäº¤è¡¨å–®
  function submitForm(e) {
    e.preventDefault();

    const bounds = map.getBounds();
    const sw = bounds.getSouthWest();
    const ne = bounds.getNorthEast();
    const center = map.getCenter();

    const data = {
      localisation: document.getElementById("searchBox").value,
      mapStyle: document.getElementById("styleSelect").value,
      size: document.getElementById("sizeSelect").value,
      line1: document.getElementById("line1").value,
      line2: document.getElementById("line2").value,
      zoom: map.getZoom(),
      center: { lat: center.lat, lng: center.lng },
      bounds: {
        south: sw.lat,
        west: sw.lng,
        north: ne.lat,
        east: ne.lng
      }
    };

    console.log(data);

    alert(
      `âœ… æäº¤è³‡æ–™ï¼š\n\n` +
      `åœ°é»ï¼š${data.localisation}\n` +
      `æ¨£å¼ï¼š${data.mapStyle}\nå°ºå¯¸ï¼š${data.size}\n` +
      `Line1ï¼š${data.line1}\nLine2ï¼š${data.line2}\n\n` +
      `åœ°åœ–ç¯„åœï¼š\nå—=${data.bounds.south.toFixed(4)}, è¥¿=${data.bounds.west.toFixed(4)}\nåŒ—=${data.bounds.north.toFixed(4)}, æ±=${data.bounds.east.toFixed(4)}`
    );

    // ä½ å¯ä»¥åœ¨é€™è£¡é€åˆ°ä¼ºæœå™¨ï¼š
    // fetch("/api/save-map", { method: "POST", body: JSON.stringify(data) });
  }
</script>

</body>
</html>
